FROM ocaml/opam:$base_image
COPY install_build_deps.sh /tmp
COPY tezos-deps.opam /tmp/src/tezos-deps.opam
WORKDIR /tmp
RUN opam config exec -- ./install_build_deps.sh pin    && rm -fr ~/.opam/log/
USER root
ENV HOME /home/opam
RUN opam config exec -- ./install_build_deps.sh depext && rm -fr ~/.opam/log/
RUN apk add libsodium-dev
USER opam
RUN opam config exec -- ./install_build_deps.sh all    && rm -fr ~/.opam/log/
